name: Documentation
on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  generate:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pages: write
      id-token: write
      
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
      
    steps:
      - uses: actions/checkout@v4

      - name: Create documentation manually
        run: |
          # Create _site directory
          mkdir -p docs/_site
          
          # Copy README
          cp README.md docs/_site/
          
          # Copy spec.md if exists
          [ -f docs/spec.md ] && cp docs/spec.md docs/_site/ || true
          
          # Copy info.yaml
          cp info.yaml docs/_site/
          
          # Create index.html
          cat > docs/_site/index.html << 'EOF'
          <!DOCTYPE html>
          <html>
          <head>
              <title>MBIST with MBISR - TinyTapeout Project</title>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <style>
                  body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
                  h1 { color: #333; border-bottom: 2px solid #0366d6; padding-bottom: 10px; }
                  h2 { color: #555; margin-top: 30px; }
                  pre { background: #f6f8fa; padding: 15px; border-radius: 5px; overflow-x: auto; }
                  code { background: #f6f8fa; padding: 2px 5px; border-radius: 3px; }
                  a { color: #0366d6; text-decoration: none; }
                  a:hover { text-decoration: underline; }
                  .container { max-width: 800px; margin: 0 auto; }
              </style>
          </head>
          <body>
              <div class="container">
                  <h1>MBIST with MBISR</h1>
                  <p>Memory Built-In Self-Test with Built-In Self-Repair for TinyTapeout.</p>
                  
                  <h2>Project Information</h2>
                  <ul>
                      <li><a href="README.md">README.md</a> - Project overview</li>
                      <li><a href="spec.md">spec.md</a> - Detailed specification</li>
                      <li><a href="info.yaml">info.yaml</a> - Project metadata</li>
                  </ul>
                  
                  <h2>Repository</h2>
                  <p><a href="https://github.com/adityapundir1985/tt_um_aksp_mbist_mbisr">https://github.com/adityapundir1985/tt_um_aksp_mbist_mbisr</a></p>
                  
                  <h2>Author</h2>
                  <p>Dr. Aditya Kumar Singh Pundir</p>
              </div>
          </body>
          </html>
          EOF
          
          echo "Documentation created in docs/_site/"
          
      - name: Setup Pages
        uses: actions/configure-pages@v4
        
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: 'docs/_site'
          
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
